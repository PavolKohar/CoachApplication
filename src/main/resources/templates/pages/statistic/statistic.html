<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/layout.html :: head}">

</head>
<body class="bg-light" >
<header th:replace="~{fragments/layout.html ::header}"></header>

<div class="container mt-3">
    <a th:href="@{'/clients/detail/' + ${client.clientId}}" class="btn btn-primary">Back to client profile</a>
    <h1 class="text-center" th:text="${client.firstName} + ' ' + ${client.lastName} + ' stats '" ></h1>
    <hr>
    <div class="">
        <h2>Training statistic</h2>
        <table class="table">
            <thead>
            <tr>
                <th scope="col">All trainings</th>
                <th scope="col">Done Trainings</th>
                <th scope="col">Training success rate</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td th:text="${statistic.allTrainings}" ></td>
                <td th:text="${statistic.doneTrainings}" ></td>
                <td th:text="${statistic.percentSuccessTraining} + ' %'" ></td>
            </tr>
            </tbody>
        </table>
       <canvas id="trainingChart"></canvas>
    </div>

    <hr>
    <h2>Weight statistic</h2>
    <div class="">
        <table class="table">
            <thead>
            <tr>
                <th scope="col">Max weight</th>
                <th scope="col">Min weight</th>
                <th scope="col">Max weight difference</th>
                <th scope="col">Average weight</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td th:text="${statistic.maxWeight}" ></td>
                <td th:text="${statistic.minWeight}" ></td>
                <td th:text="${statistic.maxDiffWeight}" ></td>
                <td th:text="${statistic.averageWeight}" ></td>

            </tr>
            </tbody>
        </table>

        <canvas id="weightChart"></canvas>

    </div>

    <hr>
    <h2>Training plans statistic</h2>
    <div class="">
        <table class="table">
            <thead>
            <tr>
                <th scope="col">All plans</th>
                <th scope="col">Done plans</th>
                <th scope="col">Plans success rate</th>

            </tr>
            </thead>
            <tbody>
            <tr>
                <td th:text="${statistic.allPlans}" ></td>
                <td th:text="${statistic.donePlans}" ></td>
                <td th:text="${statistic.percentSuccessTrainingPlans} + ' %'" ></td>


            </tr>
            </tbody>
        </table>








    </div>

</div>








<script th:src="@{/scripts/bootstrap.bundle.min.js}"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script th:inline="javascript">
    // Weight Chart
    let weightLabels = [[${labels}]];
    let weightData = [[${data}]];

    new Chart(document.getElementById("weightChart"), {
        type: 'line',
        data: {
            labels: weightLabels,
            datasets: [{
                label: 'Weight Progress (kg)',
                data: weightData,
                fill: false,
                borderColor: 'rgb(75, 192, 192)',
                tension: 0.1
            }]
        },
        options: {
            responsive: true,
            scales: {
                y: {
                    beginAtZero: false
                }
            }
        }
    });

    // Training Chart
    let chartData = [[${doneTrainingsByWeek}]];
    let weekLabels = Object.keys(chartData);
    let weekData = Object.values(chartData);

    new Chart(document.getElementById("trainingChart"), {
        type: 'bar',
        data: {
            labels: weekLabels,
            datasets: [{
                label: 'Done trainings by week',
                data: weekData,
                backgroundColor: 'rgba(54, 162, 235, 0.6)',
                borderColor: 'rgb(54, 162, 235)',
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: { precision: 0 }
                }
            }
        }
    });
</script>
</body>
</html>